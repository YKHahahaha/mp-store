{"version":3,"file":"mpstore.common.js","sources":["../src/utils.js","../src/mixin.js","../src/diff.js","../src/middleware.js","../src/update.js","../src/store.js","../src/index.js"],"sourcesContent":["export const warn = message => {\r\n  throw new Error(`\\n[MpStore warn]: ${message}\\n\\n`)\r\n}\r\n\r\nexport const assert = (condition, message) => {\r\n  if (condition) warn(message)\r\n}\r\n\r\nexport const mergeState = (oldState, newState) => {\r\n  return Object.freeze({ ...oldState, ...newState })\r\n}\r\n\r\nexport const isEmptyObject = obj => {\r\n  for (const key in obj){\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport const remove = (list, item) => {\r\n  const index = list.indexOf(item)\r\n  if (index > -1) {\r\n    list.splice(index, 1)\r\n  }\r\n}\r\n\r\nexport const callHook = (hooks, name, args) => {\r\n  if (hooks && typeof hooks[name] === 'function') {\r\n    return hooks[name].apply(hooks, args)\r\n  }\r\n}\r\n\r\nexport const mapObject = (obj, fn) => {\r\n  const desObject = {}\r\n  for (const key in obj) {\r\n    if (obj.hasOwnProperty(key)) {\r\n      desObject[key] = fn(obj[key])\r\n    }\r\n  }\r\n  return desObject\r\n}\r\n\r\nexport const isPlainObject = obj => {\r\n  if (typeof obj !== 'object' || obj === null) return false\r\n\r\n  const proto = Object.getPrototypeOf(obj)\r\n  if (proto === null) return true\r\n\r\n  let baseProto = proto\r\n  while (Object.getPrototypeOf(baseProto) !== null) {\r\n    baseProto = Object.getPrototypeOf(baseProto)\r\n  }\r\n  return proto === baseProto\r\n}","import { assert } from './utils'\r\n\r\nexport default function (inject) {\r\n  const expandMethods = Object.create(null)\r\n\r\n  if (typeof inject === 'function') {\r\n    const callback = (name, fn) => {\r\n      assert(\r\n        typeof name !== 'string' || typeof fn !== 'functin',\r\n        `Mixed callback parameters are illegal.`,\r\n      )\r\n\r\n      assert(\r\n        name in expandMethods,\r\n        `The \"${name}\" is exist,`, +\r\n          `Please don't repeat mixin.`\r\n      )\r\n\r\n      expandMethods.name = fn\r\n    }\r\n\r\n    inject(callback)\r\n  }\r\n  return expandMethods\r\n}","export const ADD = 1\r\nexport const REMOVE = 2\r\nexport const REPLACE = 3\r\n\r\nfunction Patch (type, path, value, leftValue) {\r\n  this.type = type\r\n  this.path = path\r\n  this.value = value\r\n  this.leftValue = leftValue\r\n}\r\n\r\n// compare left and right values\r\nfunction diffValues (left, right, path, patchs) {\r\n  // filter functin and null\r\n  if (typeof left === 'function' || left === null) {\r\n    patchs.push(new Patch(REPLACE, path, right, left))\r\n  } else if (Array.isArray(left)) {\r\n    // diff array\r\n    if (Array.isArray(right)) {\r\n      walkArray(left, right, path, patchs)\r\n    } else {\r\n      patchs.push(new Patch(REPLACE, path, right, left))\r\n    }\r\n  } else if (typeof left === 'object') {\r\n    // diff object\r\n    if (\r\n        right !== null &&\r\n        typeof right === 'object' &&\r\n        !Array.isArray(right)\r\n    ) {\r\n      // filter Date object\r\n      if (left instanceof Date || right instanceof Date) {\r\n        patchs.push(new Patch(REPLACE, path, right, left))\r\n      } else {\r\n        walkObject(left, right, path, patchs)\r\n      }\r\n    } else {\r\n      patchs.push(new Patch(REPLACE, path, right, left))\r\n    }\r\n  } else {\r\n    patchs.push(new Patch(REPLACE, path, right, left))\r\n  }\r\n}\r\n\r\nfunction walkArray (a, b, base, patchs) {\r\n  if (a.length <= b.length) {\r\n    let len = a.length\r\n    while (--len >= 0) {\r\n      if (a[len] !== b[len]) {\r\n        const path = `${base}[${len}]`\r\n        diffValues(a[len], b[len], path, patchs)\r\n      }\r\n    }\r\n  \r\n    if (b.length > a.length) {\r\n      len = b.length\r\n      while (--len >= a.length) {\r\n        const path = `${base}[${len}]`\r\n        patchs.push(new Patch(ADD, path, b[len], a[len]))\r\n      }\r\n    }\r\n  } else {\r\n    // if new list less than old list,\r\n    // no need diff, direct replac is fine.\r\n    patchs.push(new Patch(REPLACE, base, b, a))\r\n  }\r\n}\r\n\r\nfunction walkObject (a, b, base, patchs) {\r\n  // walk left object\r\n  for (const key in a) {\r\n    // current path\r\n    const path = `${base}['${key}']`\r\n\r\n    if (!(key in b)) {\r\n      patchs.push(new Patch(REMOVE, path, null, a[key]))\r\n    } else if (a[key] !== b[key]) {\r\n      diffValues(a[key], b[key], path, patchs)\r\n\r\n      // don't use `delete` statement,\r\n      // will destroy the stability of the `object` structure\r\n      // delete b[key]\r\n    }\r\n  }\r\n\r\n  // walk right object\r\n  for (const key in b) {\r\n    if (!(key in a)) {\r\n      const path = `${base}['${key}']`\r\n      patchs.push(new Patch(ADD, path, b[key], null))\r\n    }\r\n  }\r\n}\r\n\r\n// root `a` and root `b` is an object\r\nexport const diff = (a, b, basePath) => {\r\n  const patchs = []\r\n  walkObject(a, b, basePath, patchs)\r\n  return patchs\r\n}\r\n\r\nconst REG = /[^\\[]+(?=\\])/g\r\nconst filter = key => key.replace(/'/g, '')\r\n\r\n// return target object\r\nconst separatePath = (obj, path) => {\r\n  const keys = path.match(REG)\r\n\r\n  if (keys) {\r\n    let i = -1\r\n    let key = null\r\n    let target = obj\r\n    let prevTarget = null\r\n\r\n    while (i++ < keys.length - 2) {\r\n      prevTarget = target\r\n      key = filter(keys[i])\r\n      target = target[key]\r\n    }\r\n\r\n    return [target, key, prevTarget, filter(keys[keys.length -1])]\r\n  }\r\n}\r\n\r\nexport const restore = (obj, patchs) => {\r\n  let len = patchs.length\r\n  const delEmptys = new Map()\r\n\r\n  while (--len >= 0) {\r\n    const { type, path, leftValue } = patchs[len]\r\n    const parseItem = separatePath(obj, path)\r\n\r\n    if (parseItem) {\r\n      const [target, key, prevTarget, lastKey] = parseItem\r\n\r\n      // reverse recovery\r\n      switch (type) {\r\n        case REMOVE :\r\n          target[lastKey] = leftValue\r\n          break\r\n        case REPLACE :\r\n          target[lastKey] = leftValue\r\n          break\r\n        case ADD :\r\n          if (Array.isArray(target) && target === prevTarget[key]) {\r\n            delEmptys.set(target, { key, prevTarget })\r\n          }\r\n          delete target[lastKey]\r\n          break\r\n      }\r\n    }\r\n  }\r\n\r\n  delEmptys.forEach(({ key, prevTarget }, target) => {\r\n    const clone = new target.constructor()\r\n    // filter empty item\r\n    target.forEach(item => clone.push(item))\r\n    prevTarget[key] = clone\r\n  })\r\n\r\n  return obj\r\n}","export const COMMONACTION = '*'\r\n\r\nconst match = (layer, action) => {\r\n  if (action === COMMONACTION) return true\r\n  return action === layer.action\r\n}\r\n\r\nconst handleLayer = (fn, action, store, payload, next) => {\r\n  try {\r\n    fn.call(store, payload, next)\r\n  } catch (err) {\r\n    const hooks = store.hooks\r\n\r\n    // if the error hook exist, don't throw error\r\n    if (hooks && typeof hooks['middlewareError'] === 'function') {\r\n      hooks['middlewareError'](action, payload, err)\r\n    } else {\r\n      warn(`${err}\\n\\n   --- from [${action}] action.`)\r\n    }\r\n  }\r\n}\r\n\r\n// deal with all middleware\r\nexport default class Middleware {\r\n  constructor (store) {\r\n    this.stack = []\r\n    this.store = store\r\n  }\r\n\r\n  use (action, fn) {\r\n    this.stack.push({ fn, action })\r\n  }\r\n\r\n  remove (action, fn) {\r\n    const idx = this.stack.findIndex(layer => {\r\n      return layer.fn === fn && layer.action === action\r\n    })\r\n\r\n    if (idx > -1) {\r\n      this.stack.splice(idx, 1)\r\n    }\r\n  }\r\n\r\n  process (action, payload) {\r\n    if (this.stack.length > 0) {\r\n      let idx = 0\r\n      const next = prevPayload => {\r\n        let layer = this.stack[idx]\r\n\r\n        while (layer && !match(layer, action)) {\r\n          layer = this.stack[++idx]\r\n        }\r\n\r\n        if (layer) {\r\n          // put `try catch` in a separate function,\r\n          // avoid the entire function not being optimized.\r\n          handleLayer(layer.fn, action, this.store, prevPayload, next)\r\n        }\r\n\r\n        idx++\r\n      }\r\n\r\n      next(payload)\r\n    }\r\n  }\r\n}","import { diff } from './diff'\r\nimport { callHook } from './utils'\r\nimport { GLOBALWORD } from './store'\r\n\r\nexport const applyPatchs = (component, patchs) => {\r\n  const desObject = {}\r\n\r\n  for (let i = 0, len = patchs.length; i < len; i++) {\r\n    const { value, path } = patchs[i]\r\n    desObject[path] = value\r\n  }\r\n\r\n  component.setData(desObject)\r\n}\r\n\r\n// update page and component\r\nexport const updateComponents = (deps, hooks) => {\r\n  for (let i = 0, len = deps.length; i < len; i++) {\r\n    const { isPage, component, didUpdate, willUpdate, createState } = deps[i]\r\n\r\n    if (component.data[GLOBALWORD]) {\r\n      const newPartialState = createState()\r\n\r\n      // the `willUpdate` function will optimize component\r\n      if (typeof willUpdate === 'function') {\r\n        if (willUpdate(newPartialState) === false) {\r\n          continue\r\n        }\r\n      }\r\n\r\n      // the base path is `GLOBALWORD`\r\n      // example: this.setData({ 'global.xx': xx })\r\n      const patchs = diff(component.data[GLOBALWORD], newPartialState, GLOBALWORD)\r\n\r\n      if (patchs.length > 0) {\r\n        // call global hooks\r\n        const params = [component, newPartialState, patchs, isPage]\r\n        if (callHook(hooks, 'willUpdate', params) === false) {\r\n          continue\r\n        }\r\n\r\n        // update component\r\n        applyPatchs(component, patchs)\r\n\r\n        if (typeof didUpdate === 'function') {\r\n          didUpdate(newPartialState)\r\n        }\r\n        callHook(hooks, 'didUpdate', [component, newPartialState, isPage])\r\n      }\r\n    }\r\n  }\r\n}","import {\r\n  warn,\r\n  assert,\r\n  remove,\r\n  callHook,\r\n  mapObject,\r\n  mergeState,\r\n  isPlainObject,\r\n} from './utils'\r\nimport { diff } from './diff'\r\nimport Middleware, { COMMONACTION } from './middleware'\r\nimport { applyPatchs, updateComponents } from './update'\r\n\r\n// global state namespace\r\nexport let GLOBALWORD = 'global'\r\n\r\nconst assertReducer = (state, action, reducer) => {\r\n  const { setter, partialState } = reducer\r\n\r\n  assert(\r\n    !('partialState' in reducer),\r\n    `You must defined \"partialState\" of \"${action}\".`,\r\n  )\r\n\r\n  assert(\r\n    !partialState || typeof partialState !== 'object',\r\n    `The partialState of \"${action}\" must be an object.`,\r\n  )\r\n\r\n  for (const key in partialState) {\r\n    assert(\r\n      state.hasOwnProperty(key),\r\n      `The \"${key}\" already exists in global state,` +\r\n        'Please don\\'t repeat defined.'\r\n    )\r\n  }\r\n\r\n  if (typeof setter !== 'function') {\r\n    reducer.setter = () => {\r\n      warn(\r\n        `Can\\'t set \"${action}\" value. ` +\r\n          'Have you defined a setter?'\r\n      )\r\n    }\r\n  }\r\n  return reducer\r\n}\r\n\r\nexport default class Store {\r\n  constructor (hooks) {\r\n    this.state = {}\r\n    this.hooks = hooks\r\n    this.reducers = []\r\n    this.depComponents = []\r\n    this.isDispatching = false\r\n    this.middleware = new Middleware(this)\r\n  }\r\n\r\n  add (action, reducer) {\r\n    const { partialState } = assertReducer(this.state, action, reducer)\r\n\r\n    reducer.action = action\r\n    this.reducers.push(reducer)\r\n    this.state = mergeState(this.state, partialState)\r\n  }\r\n\r\n  dispatch (action, payload) {\r\n    const { reducers, isDispatching } = this\r\n\r\n    // if we in call dispatch process,\r\n    // we don't allow call dispacth again.\r\n    assert(\r\n      isDispatching,\r\n      'It is not allowed to call \"dispatch\" during dispatch execution.' +\r\n        `\\n\\n   --- from [${action}] action.`\r\n    )\r\n\r\n    const reducer = reducers.find(v => v.action === action)\r\n\r\n    assert(\r\n      !reducer,\r\n      `The \"${action}\" does not exist. ` +\r\n        'Maybe you have not defined.'\r\n    )\r\n\r\n    const fn = prevPayload => {\r\n      this.isDispatching = true\r\n\r\n      // the current function is called only once\r\n      this.middleware.remove(action, fn)\r\n      \r\n      try {\r\n        const newPartialState = reducer.setter(this.state, prevPayload)\r\n        this.state = mergeState(this.state, newPartialState)\r\n      } catch (err) {\r\n        // if call setter function throw an error,\r\n        // the `isDispatching` need restore.\r\n        this.isDispatching = false\r\n        warn(`${err}\\n\\n   --- from [${action}] action setter.`)\r\n      }\r\n      \r\n      // update components\r\n      updateComponents(this.depComponents, this.hooks)\r\n\r\n      this.isDispatching = false\r\n    }\r\n\r\n    // add setter fn to middleware\r\n    this.middleware.use(action, fn)\r\n\r\n    // call all middleware\r\n    this.middleware.process(action, payload)\r\n  }\r\n\r\n  // add middleware\r\n  use (action, fn) {\r\n    if (typeof action !== 'string') {\r\n      fn = action\r\n      action = COMMONACTION\r\n    }\r\n\r\n    this.middleware.use(action, fn)\r\n    return () => this.middleware.remove(action, fn)\r\n  }\r\n\r\n  // allow change `GLOBALWORD`.\r\n  setNamespace (key) {\r\n    if (typeof key === 'string') {\r\n      GLOBALWORD = key\r\n    }\r\n  }\r\n\r\n  // insert method\r\n  _rewirteCfgAndAddDep (config, isPage) {\r\n    let createState = null\r\n    const store = this\r\n    const { data, storeConfig = {} } = config\r\n    const { didUpdate, willUpdate, defineReducer, defineGlobalState } = storeConfig\r\n\r\n    // this is a uitl method,\r\n    // allow craete reducer in the page or component.\r\n    if (typeof defineReducer === 'function') {\r\n      defineReducer.call(store, store)\r\n      delete config.storeConfig\r\n    }\r\n\r\n    // get the global state words used\r\n    if (typeof defineGlobalState === 'function') {\r\n      const defineObject = defineGlobalState.call(store, store)\r\n      createState = () => mapObject(defineObject, fn => fn(this.state))\r\n    }\r\n\r\n    // get state used by the current component\r\n    if (createState !== null) {\r\n      const usedState = createState()\r\n      if (isPlainObject(usedState)) {\r\n        data \r\n          ? data[GLOBALWORD] = usedState\r\n          : config.data = { [GLOBALWORD]: usedState }\r\n      }\r\n    }\r\n\r\n    const addDep = component => {\r\n      const shouldAdd = callHook(this.hooks, 'addDep', [component, isPage])\r\n\r\n      // if no used global state word,\r\n      // no need to add dependencies.\r\n      if (shouldAdd !== false && createState !== null) {\r\n        if (isPlainObject(component.data[GLOBALWORD])) {\r\n          // add component to depComponents\r\n          this.depComponents.push({\r\n            isPage,\r\n            component,\r\n            didUpdate,\r\n            willUpdate,\r\n            createState,\r\n          })\r\n\r\n          // if the global state is changed, need update component\r\n          const patchs = diff(component.data[GLOBALWORD], createState())\r\n          if (patchs.length > 0) {\r\n            applyPatchs(component, patchs)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (isPage) {\r\n      const nativeLoad = config.onLoad\r\n      const nativeUnload = config.onUnload\r\n\r\n      config.onLoad = function (opts) {\r\n        addDep(this)\r\n\r\n        // rigister store to component within\r\n        this.store = store\r\n        if (typeof nativeLoad === 'function') {\r\n          nativeLoad.call(this, opts)\r\n        }\r\n      }\r\n\r\n      config.onUnload = function (opts) {\r\n        if (typeof nativeUnload === 'function') {\r\n          nativeUnload.call(this, opts)\r\n        }\r\n\r\n        // clear cache\r\n        this.store = null\r\n        remove(store.depComponents, this)\r\n      }\r\n    } else {\r\n      // Component\r\n      config.lifetimes = config.lifetimes || {}\r\n      const nativeAttached = config.attached || config.lifetimes.attached\r\n      const nativeDetached = config.detached || config.lifetimes.detached\r\n\r\n      config.attached =\r\n      config.lifetimes.attached = function (opts) {\r\n        addDep(this)\r\n        this.store = store\r\n\r\n        if (typeof nativeAttached === 'function') {\r\n          nativeAttached.call(this, opts)\r\n        }\r\n      }\r\n\r\n      config.detached =\r\n      config.lifetimes.detached = function (opts) {\r\n        if (typeof nativeDetached === 'function') {\r\n          nativeDetached.call(this, opts)\r\n        }\r\n\r\n        this.store = null\r\n        remove(store.depComponents, this)\r\n      }\r\n    }\r\n  }\r\n}","import mixin from './mixin'\r\nimport Store from './store'\r\nimport { callHook, isEmptyObject } from './utils'\r\nexport { restore } from './diff'\r\n\r\nconst nativePage = Page\r\nconst nativeComponent = Component\r\n\r\nconst expandConfig = (config, expandMethods, isPage) => {\r\n  if (!isEmptyObject(expandMethods)) {\r\n    if (isPage) {\r\n      Object.assign(config, expandMethods)\r\n    } else {\r\n      if (config.methods) {\r\n        Object.assign(config.methods, expandMethods)\r\n      } else {\r\n        config.methods = { ...expandMethods }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default function (mixinInject, hooks) {\r\n  const store = new Store(hooks)\r\n  const expandMethods = mixin(mixinInject)\r\n\r\n  // we can rewirte Page and Component function\r\n  // this will be better compatible with previous project\r\n  function createPage (config) {\r\n    expandConfig(config, expandMethods, true)\r\n    \r\n    // the store will record all page and component\r\n    // when global state changed, the dependent components will be update\r\n    store._rewirteCfgAndAddDep(config, true)\r\n\r\n    // we allow add additional config attributes\r\n    callHook(hooks, 'createBefore', [true, config])\r\n    const result = nativePage.call(this, config)\r\n    callHook(hooks, 'created', [true])\r\n    return result\r\n  }\r\n\r\n  function createComponent (config) {\r\n    expandConfig(config, expandMethods, false)\r\n    store._rewirteCfgAndAddDep(config, false)\r\n\r\n    callHook(hooks, 'createBefore', [false, config])\r\n    const result = nativeComponent.call(this, config)\r\n    callHook(hooks, 'created', [true])\r\n    return result\r\n  }\r\n\r\n  return { createPage, createComponent, store }\r\n}"],"names":["warn","message","Error","assert","condition","mergeState","oldState","newState","Object","freeze","isEmptyObject","obj","key","remove","list","item","index","indexOf","splice","callHook","hooks","name","args","apply","mapObject","fn","desObject","hasOwnProperty","isPlainObject","proto","getPrototypeOf","baseProto","inject","expandMethods","create","callback","ADD","REMOVE","REPLACE","Patch","type","path","value","leftValue","diffValues","left","right","patchs","push","Array","isArray","walkArray","Date","walkObject","a","b","base","length","len","diff","basePath","REG","filter","replace","separatePath","keys","match","i","target","prevTarget","restore","delEmptys","Map","parseItem","lastKey","set","forEach","clone","constructor","COMMONACTION","layer","action","handleLayer","store","payload","next","call","err","Middleware","stack","use","idx","findIndex","process","prevPayload","applyPatchs","component","setData","updateComponents","deps","isPage","didUpdate","willUpdate","createState","data","GLOBALWORD","newPartialState","params","assertReducer","state","reducer","setter","partialState","Store","reducers","depComponents","isDispatching","middleware","add","dispatch","find","v","setNamespace","_rewirteCfgAndAddDep","config","storeConfig","defineReducer","defineGlobalState","defineObject","usedState","addDep","shouldAdd","nativeLoad","onLoad","nativeUnload","onUnload","opts","lifetimes","nativeAttached","attached","nativeDetached","detached","nativePage","Page","nativeComponent","Component","expandConfig","assign","methods","mixinInject","mixin","createPage","result","createComponent"],"mappings":"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"}